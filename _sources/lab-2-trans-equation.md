# Лабораторная работа №2: "Ударная труба"


## Предварительная теория

### Численное интегрирование обыкновенного дифференциального уравнения: явный метод Эйлера

Рассмотрим дифференциальное уравнение вида

$$
\frac{\mathrm{d} s}{\mathrm{d} t} = \dot s(t) = f(s, t),
$$

при $t_0 \le t \le t_\mathrm{к}$,
где $t_0$ и $t_\mathrm{к}$ — пределы интегрирования ОДУ по времени;
$s(t=0) = s_0$ — начальное условие.

Найдем приближенное решение в момент $t_1 = t_0 + \Delta t$:

$$
s(t_0 + \Delta t) =
s(t_0) +
\Delta t \cdot \dot s(t_0) + O(\Delta t^2).
$$

Заменяя $\dot s$ на $f(s, t)$, получим

$$
s(t_1) =
s(t_0) +
\Delta t \cdot f\left( s(t_0), t_0 \right).
$$

Выполняя этот процесс итерационно, найдем общее соотношение

$$
s(t_{n+1}) =
s(t_n) +
\Delta t \cdot f\left( s(t_n), t_n \right),
$$

$$
t_{n+1} = t_n + \Delta t.
$$

Полученное уравнение можно записать в несколько упрощённом виде:

$$
s^{n+1} = s^n + \Delta t \cdot f(s^n, t_n),
$$

верхний индекс отвечает за номер шага по времени.

Здесь $s(t_{n+1})$ явно зависит от $s(t_n)$ — **метод явный**.

Данный метод довольно просто реализуется в виде кода.


### Пример: остывание чашки кофе

Скорость изменения температуры кофе в чашке определяется таким ОДУ:

$$
\frac{\mathrm{d} T}{\mathrm{d} t} = -r (T - T_\mathrm{окр}),
$$

где
$T_\mathrm{окр}$ — температура окружающей среды;
$r$ — коэффициент "остывания" (теплоотдачи).

Начальную температуру кофе обозначим как
$T^0 = T(t=0)$.

Численное решение этого уравнение явным методом Эйлера
выглядит следующим образом:

$$
T^{n+1} = T^n - \Delta t \cdot r \cdot (T^n - T_\mathrm{окр}).
$$


### Уравнение переноса: физический и математический смысл

Уравнение переноса для функции $s(t,x)$ имеет вид

$$
\frac{\partial s}{\partial t} + c \frac{\partial s}{\partial x} = 0.
$$

Такое уравнение может описывать, например,
концентрацию пыли в потоке воздуха.

Начальное условие: $s(t=0) = q(x)$,
где начальное распределение $q(x)$ может описываться, к примеру,
ступенчатой функцией:

$$
q(x) = \begin{cases}
    0, & x < 0, \\
    1, & 0 \le x \le 1, \\
    0, & x > 1.
\end{cases}
$$

Граничных условий нет (бесконечная прямая).

Одномерное уравнение переноса имеет известное точное решение:

$$
s(t, x) = q(x - c t).
$$


### Дискретизация уравнения переноса

Введём равномерную разностную сетку по координате
$x_0, x_1, \ldots, x_N$, причём

$$
x_1 - x_0 = x_2 - x_1 = \ldots = x_N - x_{N-1} = \Delta x.
$$

Количество узлов сетки $N = (x_N - x_0) / \Delta x$.

Искомая сеточная функция определена в каждой точке
дискретной разностной сетки:
$s_k = s(x_k)$.
Нижний индекс отвечает за номер шага по координате (пространству).

Зависимость от времени здесь опущена, но подразумевается.


### Аппроксимация производных конечными разностями

Разложим функцию $s(x)$ в ряд Тейлора:

$$
s(x + \Delta x) =
    s(x) +
    \Delta x \cdot s'(x) +
    \frac{\Delta x^2}{2!} s''(x) +
    \frac{\Delta x^3}{3!} s'''(x) + \ldots,
$$

$$
s(x - \Delta x) =
    s(x) -
    \Delta x \cdot s'(x) +
    \frac{\Delta x^2}{2!} s''(x) -
    \frac{\Delta x^3}{3!} s'''(x) + \ldots.
$$

Из первой формулы можно получить разность "вперёд":

$$
s'(x) =
    \frac{s(x + \Delta x) - s(x)}{\Delta x} -
    \frac{1}{2} \Delta x \cdot s''(x) - \ldots.
$$ (eq_diff_forward)

Из второй формулы – разность "назад":

$$
s'(x) =
    \frac{s(x) - s(x - \Delta x)}{\Delta x} +
    \frac{1}{2} \Delta x \cdot s''(x) - \ldots.
$$ (eq_diff_backward)

Вычитая эти формулы, получим центральную разность:

$$
s'(x) =
    \frac{s(x + \Delta x) - s(x - \Delta x)}{2 \Delta x} -
    \frac{1}{6} \Delta x^2 s'''(x) + \ldots.
$$


### Разностные схемы уравнения переноса

Будем обозначать $s_i^n = s(x_i, t_n)$.

Разность "вперёд" и по времени и по координате:

$$
\frac{{\color{purple} s_i^{n+1}} - s_i^n}{\Delta t} +
c \frac{s_{i+1}^n - s_i^n}{\Delta x}
= 0.
$$

```{warning}
Эта схема оказывается всегда неустойчивой.
```

Разность "вперёд" по времени и "назад" по координате:

$$
\frac{{\color{purple} s_i^{n+1}} - s_i^n}{\Delta t} +
c \frac{s_i^n - s_{i-1}^n}{\Delta x}
= 0.
$$

Условие Куранта-Фридрихса-Леви (CFL):

$$
\mathrm{CFL} = c \frac{\Delta t}{\Delta x} < 1.
$$ (eq_CFL)

Неявная схема:

$$
\frac{{\color{purple} s_i^{n+1}} - s_i^n}{\Delta t} +
c \frac{{\color{purple} s_i^{n+1}} - {\color{blue} s_{i-1}^{n+1}}}{\Delta x}
= 0.
$$

Неявная схема сложнее в реализации, но она безусловно устойчива.


## Упражнение

В выражении критерия CFL {eq}`eq_CFL` написано строгое неравенство.
Но что мы получим, если примем $\mathrm{CFL} = 1$ и, исходя из этого,
преобразуем выражения {eq}`eq_diff_forward` и {eq}`eq_diff_backward`?

Проделайте это.
Проанализируйте результат.
Это закономерность или удачный случай?


## Лабораторная работа

### Часть 1

Оттачиваем навыки Python и численного решения дифференциальных
уравнений в частных производных, а именно, уравнения переноса.

Само уравнение выглядит так:

$$
\frac{\partial s}{\partial t} +
c \frac{\partial s}{\partial x}
= 0,
$$ (eq_trans)

где
$s$ — некоторая физическая величина: концентрация вещества,
плотность и т.д.;
$c$ — скорость переноса этой величины в данном случае
в направлении оси $x$.

Запишем это уравнение в виде разностной схемы Эйлера:

$$
\frac{s_k^{n+1} - s_k^n}{\Delta t} +
c \frac{s_{k+1}^n - s_k^n}{\Delta x}
= 0,
$$

или

$$
s_k^{n+1} = s_k^n - c \frac{\Delta t}{\Delta x}
(s_{k+1}^n - s_k^n),
$$ (num_scheme)

где верхний индекс отражает номер шага по времени,
а нижний — по координате.

При решении задачи Коши для уравнения
{eq}`eq_trans` необходимо задать 
сетку $X$ в пределах от $x_\mathrm{нач}$ до $x_\mathrm{к}$ с $N$ узлами
и начальное распределение функции $s$ по этой сетке, т. е. функцию:

$$
s(t=0, x) = q(x).
$$

#### Задача первой части лабораторной работы

Требуется написать программу решения уравнения
{eq}`eq_trans`, используя схему {eq}`num_scheme` и
обеспечивая её устойчивость.


### Часть 2 — задача Сода

Имеется бесконечной длины труба с непроницаемой перегородкой
(мембраной) с координатой $x_а = 1/2$.
Слева от перегородки находится идеальный газ с параметрами
$p_\mathrm{л}$, $\rho_\mathrm{л}$ и $u_\mathrm{л}$,
справа — газ с параметрами
$p_\mathrm{п}$, $\rho_\mathrm{п}$ и $u_\mathrm{п}$.

В момент времени $t=0$ мембрана мгновенно исчезает.

**Требуется** определить параметры смеси газов на участке трубы
$x \in [0; 1]$ в заданный момент времени $t_\mathrm{к}$.
Иными словами в момент времени $t_\mathrm{к}$
найти распределение по длине трубы
давления смеси $p(x)$,
плотности $\rho(x)$,
полной энергии $E(x)$,
а также скорости $u(x)$.

#### Теория

Математически процессы, происходящие в рассматриваемой
ударной трубе, описываются системой дифференциальных уравнений в
частных производных — нестационарными уравнениями ГД — вида:

$$
\begin{cases}
    \cfrac{\partial \rho}{\partial t} +
    \cfrac{\partial \rho u}{\partial x}
    = 0, \\
    \cfrac{\partial \rho u}{\partial t} +
    \cfrac{\partial}{\partial x} (\rho u^2 + p)
    = 0, \\
    \cfrac{\partial \rho E}{\partial t} +
    \cfrac{\partial}{\partial x} \left[
        \rho u \left( E + \cfrac{p}{\rho} \right)
    \right]
    = 0, \\
    E = \varepsilon + \cfrac{u^2}{2}.
\end{cases}
$$ (sod_system)

Систему {eq}`sod_system` можно переписать в векторном виде:

$$
\frac{\partial \vec q}{\partial t} +
\frac{\partial \vec f}{\partial x}
= 0,
$$

где
$\vec q$ — вектор канонических переменных:

$$
\vec q = \left[\begin{matrix}
    \rho \\ \rho u \\ \rho E
\end{matrix}\right];
$$

$\vec f$ — вектор потоков:

$$
\vec f = \left[\begin{matrix}
    \rho u \\ \rho u^2 + p \\ \rho u H
\end{matrix}\right];
$$

$E$ — полная энергия газа;
$\varepsilon$ — внутренняя энергия газа;
$H$ — энтальпия газа, $H = E + p/\rho$;
$p$ — статическое давление газа;
$\rho$ — плотность газа;
$u$ — скорость газа.

Полученное уравнение может быть решено численно
методом Годунова:

$$
\vec q_{k+1/2}^{n+1} =
\vec q_{k+1/2}^{n} - \frac{\Delta t}{\Delta x}
(\vec f_{k+1}^n - \vec f_k^n),
$$ (eq_godunov)

где поток на левой границе ячейки $k+1/2$ рассчитывается по методу Русанова:

$$
\vec f_k^n =
\frac{1}{2}
\left[
    \vec f_{k-1/2}^n + f_{k+1/2}^n -
    c_\mathrm{max} (\vec q_{k+1/2}^n - \vec q_{k-1/2}^n)
\right].
$$ (eq_rusanov)

В {eq}`eq_godunov` и {eq}`eq_rusanov` дробные индексы соответствуют центрам расчётных ячеек,
целочисленные индексы — границам этих ячеек.
Так, левая и правая граница ячейки $k+1/2$ имеют индексы $k$ и $k+1$ соответственно.

Таким образом, требуется решить систему уравнений {eq}`sod_system`
методом Годунова {eq}`eq_godunov`,
рассчитывая потоки на границах ячеек по формуле {eq}`eq_rusanov`.
