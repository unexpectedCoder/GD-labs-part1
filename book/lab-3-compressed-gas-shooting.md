# Лабораторная работа №3: "Методы численного расчёта баллистической задачи Лагранжа"


## Задача

Есть труба с подвижным поршнем.
Поршень способен двигаться без трения и обеспечивает герметичность трубы.
За поршнем находится изначально сжатый газ.
В начальный момент времени поршень и газ покоятся.


## Требуется

1. Смоделировать движение поршня в трубе под действием сжатого газа.
2. Построить графики:
   * координаты $x_\mathrm{п}(t)$ и скорости $u_\mathrm{п}(t)$ поршня от времени;
   * давления на дно трубы $p_\mathrm{т}(t)$ и поршень $p_\mathrm{п}(t)$ от времени;
   * распределение давления газа в каждый момент времени $p(t, x)$.
3. Сравнить численные решения с точными.
4. Проанализировать полученные результаты.


## Исходные данные

Число контрольных объёмов $N = 300$.
Масса поршня $m = 0.1$ кг, его начальная координата $x_0 = 0.5$ м и диаметр $d = 0.03$ м.
Длина трубы $L = 2$ м.
Параметры газа: $p_0 = 5$ МПа (давление), $T_0 = 300$ К (температура), $R = 287$ Дж/(кг$\cdot$К) (удельная газовая постоянная), $k = 1.4$ (показатель адиабаты).
Число CFL $\mathrm{Ku} = 0.5$.


## Часть 1 — Решение задачи Лагранжа в массовых лагранжевых координатах


### Математическая модель

Уравнения газовой динамики в массовых лагранжевых координатах
записываются следующим образом:

$$
\frac{\mathrm{d}}{\mathrm{d} t} \left( \frac{1}{\rho} \right)
- S \frac{\partial u}{\partial \xi}
= 0,
$$

$$
\frac{\mathrm{d} u}{\mathrm{d} t}
+ S \frac {\partial p}{\partial \xi}
= 0,
$$

$$
\frac{\mathrm{d} \varepsilon}{\mathrm{d} t}
+ p S \frac {\partial u}{\partial \xi}
= 0,
$$

где массовая лагранжева координата $\xi$ представляет собой интеграл

$$
\xi = \int\limits_{x_1}^{x_2} \rho(x) \, \mathrm{d} x.
$$


### Численный метод Неймана

$$
u^{n+1}_i =
u^n_i
- \tau^n \frac{p^n_{i+1/2}
- p^n_{i-1/2}} {0.5 (\xi_{i+1/2}
+ \xi_{i-1/2}) + \xi_i} S,
$$

$$
x^{n+1}_i = x^n_i + \tau^n u^{n+1}_i,
$$

$$
\rho^{n+1}_{i+1/2} =
\frac{\xi_{i+1/2}}{x^{n+1}_{i+1} - x^{n+1}_i},
$$

$$
{\color{green} \varepsilon^{n+1}_{i+1/2}} =
\varepsilon^n_{i+1/2}
- \tau^n S \frac{{\color{blue} p^{n+1}_{i+1/2}}
+ p^n_{i+1/2}}{2} \frac{u^{n+1}_{i+1}
- u^{n+1}_i}{\xi_{i+1/2}},
$$

$$
{\color{blue} p^{n+1}_{i+1/2}} =
(k-1) \rho^{n+1}_{i+1/2}
{\color{green} \varepsilon^{n+1}_{i+1/2}}.
$$

Схема формально является неявной.
Однако её легко привести к явной, решив систему линейных алгебраических уравнений (два последних уравнения).

Приняты следующие обозначения.
Дробные индексы $i+1/2$ отвечают контрольным объёмам, заключённым между **интерфейсами** (границами) с индексами $i$ и $i+1$;
$S$ — площадь поршня (сечения трубы);
$u$, $p$, $\rho$, $\varepsilon$, $k$ — скорость, давление, плотность, внутренняя энергия, показатель адиабаты газа;
$\tau$ — шаг по времени.


### Условие устойчивости численного метода

Для устойчивости метода необходимо пересчитывать временной шаг на каждой итерации интегрирования:

$$
\tau^n =
\mathrm{Ku} \cdot \min_{i=0,1,\ldots,N-1}\left(
    \frac{\Delta x^n}{c^n_{i+1/2} + |u^n_{i+1/2}|}
\right),
$$ (eq_time_step)

где
$\mathrm{Ku}$ — число CFL, $0 < \mathrm{Ku} < 1$;
$\Delta x^n$ — шаг расчётной сетки;
$N$ — число контрольных объёмов;
$c^n_{i+1/2}$ — скорость звука в контрольных объёмах:

$$
c^n_{i+1/2} =
\sqrt{k \frac{p^n_{i+1/2}}{\rho^n_{i+1/2}}};
$$

$u^n_{i+1/2}$ — скорость контрольных объёмов, как средняя скорость интерфейсов:

$$
u^n_{i+1/2} = (u^n_{i+1} + u^n_i) / 2.
$$


## Часть 2 — Решение задачи Лагранжа в эйлеровых координатах


### Математическая модель

Задача Лагранжа описывается одномерными нестационарными уравнениями газовой динамики:

$$
\frac{\partial \rho}{\partial t} + \frac{\partial \rho u}{\partial x} = 0,
$$

$$
\frac{\partial \rho u}{\partial t} + \frac{\partial}{\partial x} (\rho u^2 + p) = 0,
$$

$$
\frac{\partial \rho E}{\partial t} + \frac{\partial}{\partial x} [u (\rho E + p)] = 0,
$$

$$
E = \varepsilon + \frac{u^2}{2} = \frac{1}{k-1} \frac{p}{\rho} + \frac{u^2}{2}
$$

с подвижной границей, описываемой уравнением движения поршня

$$
\frac{\mathrm{d} u_\mathrm{п}}{\mathrm{d} t} = \frac{p_\mathrm{п} S}{m},
$$

где $p_\mathrm{п}$ — давление на дно поршня.

Начальные условия при $t = 0$:

$$\rho(x) = \rho_0, \quad   p(x) = p_0, \quad u(x) = 0, \quad u_\mathrm{п} = 0.$$

В векторном виде уравнения выше можно записать так:

$$
\frac{\partial \vec{q}}{\partial t} + \frac{\partial \vec{f}(\vec q)}{\partial x} = 0,
$$

где

$$
\vec{q} = \left[\begin{matrix}
    \rho \\ \rho u \\ \rho E
\end{matrix}\right];
\quad
\vec{f} = \left[\begin{matrix}
    \rho u  \\ \rho u^2 + p \\ u (\rho E + p)
\end{matrix}\right].
$$


### Метод численного решения

Вводится подвижная пространственная сетка.
В качестве упрощения можно её перестраивать равномерно.

Упрощённая явная разностная схема: 

$$
\vec q^{n+1}_{i+1/2} =
\frac{\Delta x^n}{\Delta x^{n+1}} \left[
    \vec q^n_{i+1/2} -
    \frac{\tau^n}{\Delta x^n} \left(
        \vec f^n_{i+1} - \vec f^n_{i}
    \right)
\right]
$$

при $i = 0, 1, \ldots, N-1$, где $N$ — число контрольных объёмов.


### Расчёт потоков по методу AUSM+

Поток на $i$-ом интерфейсе $\vec f_i$ на любом шаге по времени рассчитывается по методу AUSM+:

$$
\vec f_i = \frac{c_i}{2}\left[
    \mathrm{M}^r_i (\vec\Phi_{i+1/2} + \vec\Phi_{i-1/2})
    - |\mathrm{M}^r_i| (\vec\Phi_{i+1/2} - \vec\Phi_{i-1/2})
\right]
+ \left[\begin{matrix}
    0 \\ p_i \\ p_i u_i
\end{matrix}\right],
$$

где

$$
\vec\Phi = \left[
    \begin{matrix}
        \rho \\ \rho u \\ \rho E + p
    \end{matrix}
\right];
$$

$\mathrm{M}^r_i$ — число Маха относительно $i$-го интерфейса:

$$
\mathrm{M}^r_i =
f_\beta^+(\mathrm{M}^r_{i-1/2})
+ f_\beta^-(\mathrm{M}^r_{i+1/2})
$$

при $\mathrm{M}^r_{i \pm 1/2} = (u_{i \pm 1/2} - u_i) / c_i$;
$p_i$ — давление на интерфейсе:

$$
p_i =
g_\alpha^+(\mathrm{M}^r_{i-1/2})p_{i-1/2}
+ g_\alpha^-(\mathrm{M}^r_{i+1/2})p_{i+1/2};
$$

$c_i$ — скорость звука на интерфейсе:

$$
c_i = (c_{i-1/2} + c_{i+1/2}) / 2;
$$

$u_i$ — скорость $i$-го интерфейса:

$$
u_i = \frac{x^{n+1}_i - x^n_i}{\tau^n}.
$$

Функции $f_\beta^\pm$ и $g_\alpha^\pm$ зависят только от числа Маха в контрольных объёмах и имеют следующий вид:

$$
f_\beta^\pm(\mathrm{M}) = \begin{cases}
\cfrac{\mathrm{M} \pm |\mathrm{M}|}{2}, &
    |\mathrm{M}| \ge 1, \\
\pm \cfrac{1}{4}(\mathrm{M} \pm 1)^2 \left[
    1 + 4 \beta (\mathrm{M} \mp 1)^2
\right], &
    |\mathrm{M}| < 1;
\end{cases}
$$

$$
g_\alpha^\pm(\mathrm{M}) = \begin{cases}
\cfrac{\mathrm{M} \pm |\mathrm{M}|}{2 \mathrm{M}}, &
    |\mathrm{M}| \ge 1, \\
(\mathrm{M} \pm 1)^2 \left[
    \cfrac{2 \mp \mathrm{M}}{4} \pm \alpha\mathrm{M}(\mathrm{M} \mp 1)^2
\right], &
    |\mathrm{M}| < 1.
\end{cases}
$$

Коэффициенты можно принять следующими:
$\alpha = 3/16$, $\beta = 1/4$.


### Устойчивость метода численного решения

Условие устойчивости данного численного метода то же, что и {eq}`eq_time_step`.


## Точное решение

Точное решение баллистической задачи Лагранжа действует до момента времени $t_\mathrm{т}$:

$$
t_\mathrm{т} = \frac{x_0}{c_0} \left(
    2 + \frac{k+1}{2 k} \frac{M}{m}
\right),
$$

где
$M$ — масса газа: $M = \rho S x_0$;
$c_0$ — скорость звука с сжатом газе:

$$
c_0 = \sqrt{k p_0 / \rho_0}.
$$

Скорость поршня при $0 < t < t_\mathrm{т}$:

$$
u_\mathrm{п}(t) = \frac{2 c_0}{k - 1} \left[
    1 - \left(
        \frac{k+1}{2 k}\frac{M}{m}\frac{c_0}{x_0} t + 1
    \right)^\frac{1-k}{k+1}
\right].
$$

Координата поршня при $0 < t < t_\mathrm{т}$:

$$
x_\mathrm{п}(t) = x_0 + \frac{2 c_0}{k-1} t
+ \frac{2 k}{k-1}\frac{m}{M} x_0 \left[
    1 - \left(
        \frac{k+1}{2 k}\frac{M}{m}\frac{c_0}{x_0} t + 1
    \right)^\frac{2}{k+1}
\right].
$$
